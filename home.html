<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=">

<!-- Bootstrap -->
    <link href="frameworks/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="frameworks/bootstrap/js/bootstrap.min.js"></script>

<!-- foursquare api stuff -->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" id="jquery"></script>
  
  <link href="frameworks/leaflet/leaflet.css" type="text/css" rel="stylesheet" />
  <link href="frameworks/foursquare/apisamples.css" type="text/css" rel="stylesheet" />
 
  <script src="frameworks/foursquare/apisamples.js" type="text/javascript"></script>
  <script src="frameworks/jquery.ba-bbq.js" type="text/javascript"></script>
  <script src="frameworks/leaflet/leaflet.js" type="text/javascript"></script>
  <script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.js'></script>

  <style type="text/css">
    html { height: 100%; }
    body { height: 100%; margin: 0; padding: 0; }
    /* Give our markers a background image */
    .leaflet-marker-icon {
      background: url(https://foursquare.com/img/pin-blue-transparent.png);
      padding: 6px;
      padding-bottom: 17px;
      top: -6px;
      left: -6px;
      }
  </style>
  <script type="text/javascript">
  
  var config = {
    apiKey: 'SSXHG3XZZNH25PGCJFR0N3WOT51BNHLRQ1HCMJDDKDXMUYCX',
    authUrl: 'https://foursquare.com/',
    apiUrl: 'https://api.foursquare.com/'
  };
  
 
  //<![CDATA[
 
  /* Attempt to retrieve access token from URL. */
  function doAuthRedirect() {
    var redirect = window.location.href.replace(window.location.hash, '');
    var url = config.authUrl + 'oauth2/authenticate?response_type=token&client_id=' + config.apiKey +
        '&redirect_uri=' + encodeURIComponent(redirect) +
        '&state=' + encodeURIComponent($.bbq.getState('req') || 'users/self');
    window.location.href = url;
  };
 
  if ($.bbq.getState('access_token')) {
    // If there is a token in the state, consume it
    var token = $.bbq.getState('access_token');
    $.bbq.pushState({}, 2)
  } else if ($.bbq.getState('error')) {
  } else {
    doAuthRedirect();
  }
 
  /* HTML 5 geolocation. */
  navigator.geolocation.getCurrentPosition(function(data) {
    var lat = data['coords']['latitude'];
    var lng = data['coords']['longitude'];
    /* Create map. */
    var map = new L.Map('map_canvas')
      .setView(new L.LatLng(lat, lng), 15);
    /**
     * This is a sample map url that you need to change.
     * Sign up at http://mapbox.com/foursquare for a custom map url.
     */
    var mapboxUrl = 'http://a.tiles.mapbox.com/v3/foursquare.map-b7qq4a62.jsonp';
    wax.tilejson(mapboxUrl, function(tilejson) {
      map.addLayer(new wax.leaf.connector(tilejson));
    });


  /* Query foursquare API for venue recommendations near the current location. */
    $.getJSON(config.apiUrl + 'v2/venues/explore?ll=' + lat + ',' + lng + '&oauth_token=' + window.token + '&v=20140601', {}, function(data) {
      venues = data['response']['groups'][0]['items'];
      /* Place marker for each venue. */
      for (var i = 0; i < venues.length; i++) {
        /* Get marker's location */
        var latLng = new L.LatLng(
          venues[i]['venue']['location']['lat'],
          venues[i]['venue']['location']['lng']
        );
        /* Build icon for each icon */
        var fsqIcon = venues[i]['venue']['categories'][0]['icon'];
        var leafletIcon = L.Icon.extend({
          iconUrl: fsqIcon['prefix'] + '32' + fsqIcon['suffix'],
          shadowUrl: null,
          iconSize: new L.Point(32,32),
          iconAnchor: new L.Point(16, 41),
          popupAnchor: new L.Point(0, -51)
        });
        var icon = new leafletIcon();
        var marker = new L.Marker(latLng, {icon: icon})
          .bindPopup(venues[i]['venue']['name'], { closeButton: false })
          .on('mouseover', function(e) { this.openPopup(); })
          .on('mouseout', function(e) { this.closePopup(); });
        map.addLayer(marker);
      }
    })
  })
  //]]>
  </script>

<!-- our files -->
    <link href="css/icebreaker.css" rel="stylesheet">
    <script src="js/icebreaker.js"></script>
    <title>IceBreaker | Home</title>
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">

  </head> 
  <body>
<!-- header -->
    <div class="container" id="header">
      <div class="row">
        <div class="col-xs-9">
          <div id="home-button">
            <a href="home.html" id="home-button">
              <h3>Icebreaker</h3>
            </a>
          </div>
        </div>
        <div class="col-xs-3">
          <button type="button" id="log-out" class="btn btn-default btn-small">
            <span class="glyphicon glyphicon-log-out"></span>
          </button>
        </div>
      </div>
    </div>
<!-- page body -->
    <div class="container" id="body">
      <div class="row">
        <div class="col-xs-4">
          <div id="profile-box">
          <!-- profile pic with name under(link to profile page) -->
          </div>
        </div>
        <div class="col-xs-8">
          <!-- 
            status text field (no button to submit, it will be at bottom of page) 
          -->       
        </div>
      </div>
      <div class="row">
        <div class="col-xs-6 col-xs-offset-3">
          <button type="button" onclick="getLocation()" class="btn btn-default btn-small">
            <span class="glyphicon glyphicon-map-marker"> Get Location</span>
          </button>
        </div>
      </div>
      <div id="out"></div>
      <div class="row">
        <div class="col-xs-10 col-xs-offset-1" id="list-places">
          <div class="container">
            <!-- make amount of rows dynamic with JS -->
            <div class="row">
              <!-- places to check in -->
            </div>
            <!-- more rows -->
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-6 col-xs-offset-3">
          <button type="button" id="post-it" class="btn btn-default btn-small">
            <span class="glyphicon glyphicon-flag"> Post It Up!</span>
          </button>
        </div>
      </div>

    </div>
    <div style="width: 100%; height: 100%;" id="map_canvas"></div>
  </body>
</html>






